
{
  "entities": {
    "UserProfile": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "UserProfile",
      "type": "object",
      "description": "Represents a user profile in the ConnectSphere app.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the UserProfile entity."
        },
        "email": {
          "type": "string",
          "description": "User's email address.",
          "format": "email"
        },
        "name": {
          "type": "string",
          "description": "User's display name."
        },
        "location": {
          "type": "string",
          "description": "User's location (e.g., city, state). Collected during signup."
        },
        "profilePicture": {
          "type": "string",
          "description": "URL of the user's profile picture.",
          "format": "uri"
        },
        "signUpTimestamp": {
          "type": "string",
          "description": "Timestamp of when the user signed up.",
          "format": "date-time"
        },
        "lastActiveTimestamp": {
          "type": "string",
          "description": "Timestamp of the user's last activity.",
          "format": "date-time"
        },
        "phoneNumber": {
          "type": "string",
          "description": "User's phone number."
        }
      },
      "required": [
        "id",
        "email",
        "name",
        "location"
      ]
    },
    "ChatMessage": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "ChatMessage",
      "type": "object",
      "description": "Represents a chat message between users.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the ChatMessage entity."
        },
        "senderId": {
          "type": "string",
          "description": "Reference to UserProfile. (Relationship: UserProfile 1:N ChatMessage - Sender)"
        },
        "recipientId": {
          "type": "string",
          "description": "Reference to UserProfile. (Relationship: UserProfile 1:N ChatMessage - Recipient)"
        },
        "content": {
          "type": "string",
          "description": "Content of the chat message."
        },
        "timestamp": {
          "type": "string",
          "description": "Timestamp of when the message was sent.",
          "format": "date-time"
        },
        "type": {
          "type": "string",
          "description": "Type of message (e.g., text, image, video, file, link)."
        },
        "mediaUrl": {
          "type": "string",
          "description": "URL of the media file, if any.",
          "format": "uri"
        }
      },
      "required": [
        "id",
        "senderId",
        "recipientId",
        "content",
        "timestamp",
        "type"
      ]
    },
    "ChatGroup": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "ChatGroup",
      "type": "object",
      "description": "Represents a chat group.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the ChatGroup entity."
        },
        "name": {
          "type": "string",
          "description": "Name of the chat group."
        },
        "description": {
          "type": "string",
          "description": "Description of the chat group."
        },
        "creatorId": {
          "type": "string",
          "description": "Reference to UserProfile. (Relationship: UserProfile 1:N ChatGroup - Creator)"
        },
        "creationTimestamp": {
          "type": "string",
          "description": "Timestamp of when the group was created.",
          "format": "date-time"
        },
        "memberIds": {
          "type": "array",
          "description": "References to UserProfiles. (Relationship: ChatGroup N:N UserProfile)",
          "items": {
            "type": "string"
          }
        }
      },
      "required": [
        "id",
        "name",
        "creatorId",
        "creationTimestamp",
        "memberIds"
      ]
    },
    "GroupChatMessage": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "GroupChatMessage",
      "type": "object",
      "description": "Represents a chat message within a group.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the GroupChatMessage entity."
        },
        "groupId": {
          "type": "string",
          "description": "Reference to ChatGroup. (Relationship: ChatGroup 1:N GroupChatMessage)"
        },
        "senderId": {
          "type": "string",
          "description": "Reference to UserProfile. (Relationship: UserProfile 1:N GroupChatMessage - Sender)"
        },
        "content": {
          "type": "string",
          "description": "Content of the group chat message."
        },
        "timestamp": {
          "type": "string",
          "description": "Timestamp of when the message was sent.",
          "format": "date-time"
        },
        "type": {
          "type": "string",
          "description": "Type of message (e.g., text, image, video, file, link)."
        },
        "mediaUrl": {
          "type": "string",
          "description": "URL of the media file, if any.",
          "format": "uri"
        }
      },
      "required": [
        "id",
        "groupId",
        "senderId",
        "content",
        "timestamp",
        "type"
      ]
    },
    "StatusUpdate": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "StatusUpdate",
      "type": "object",
      "description": "Represents a user's status update that disappears after 24 hours.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the StatusUpdate entity."
        },
        "userId": {
          "type": "string",
          "description": "Reference to UserProfile. (Relationship: UserProfile 1:N StatusUpdate)"
        },
        "content": {
          "type": "string",
          "description": "Content of the status update (e.g., text, image URL, video URL)."
        },
        "timestamp": {
          "type": "string",
          "description": "Timestamp of when the status was posted.",
          "format": "date-time"
        },
        "type": {
          "type": "string",
          "description": "Type of status update (e.g., text, image, video)."
        },
        "views": {
          "type": "array",
          "description": "List of user IDs who have viewed the status.",
          "items": {
            "type": "string"
          }
        },
        "likes": {
          "type": "array",
          "description": "List of user IDs who have liked the status.",
          "items": {
            "type": "string"
          }
        }
      },
      "required": [
        "id",
        "userId",
        "content",
        "timestamp",
        "type"
      ]
    },
    "AffiliateProduct": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "AffiliateProduct",
      "type": "object",
      "description": "Represents an affiliate product added by the admin.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the AffiliateProduct entity."
        },
        "name": {
          "type": "string",
          "description": "Name of the affiliate product."
        },
        "description": {
          "type": "string",
          "description": "Description of the affiliate product."
        },
        "imageUrl": {
          "type": "string",
          "description": "URL of the product image.",
          "format": "uri"
        },
        "link": {
          "type": "string",
          "description": "Affiliate link for the product.",
          "format": "uri"
        },
        "adminId": {
          "type": "string",
          "description": "Reference to UserProfile. (Relationship: UserProfile 1:N AffiliateProduct - Admin)"
        },
        "addedTimestamp": {
          "type": "string",
          "description": "Timestamp of when the product was added.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "name",
        "description",
        "imageUrl",
        "link",
        "adminId",
        "addedTimestamp"
      ]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous",
      "google.com"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/users/{userId}",
        "definition": {
          "entityName": "UserProfile",
          "schema": {
            "$ref": "#/backend/entities/UserProfile"
          },
          "description": "Stores user profile information.  Path-based ownership for user-specific data.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier of the user."
            }
          ]
        }
      },
      {
        "path": "/chats/{chatId}/messages/{messageId}",
        "definition": {
          "entityName": "ChatMessage",
          "schema": {
            "$ref": "#/backend/entities/ChatMessage"
          },
          "description": "Stores chat messages between users. Security rules will depend on the 'userId', 'senderId', and 'recipientId' within each ChatMessage.",
          "params": [
            {
              "name": "chatId",
              "description": "The unique identifier of the chat between two users."
            },
            {
              "name": "messageId",
              "description": "The unique identifier of the chat message."
            }
          ]
        }
      },
      {
        "path": "/groups/{groupId}",
        "definition": {
          "entityName": "ChatGroup",
          "schema": {
            "$ref": "#/backend/entities/ChatGroup"
          },
          "description": "Stores chat group information. Includes a 'members' map (userId: role) for authorization.",
          "params": [
            {
              "name": "groupId",
              "description": "The unique identifier of the chat group."
            }
          ]
        }
      },
      {
        "path": "/groups/{groupId}/messages/{messageId}",
        "definition": {
          "entityName": "GroupChatMessage",
          "schema": {
            "$ref": "#/backend/entities/GroupChatMessage"
          },
          "description": "Stores group chat messages. Includes denormalized 'members' map for authorization independence.",
          "params": [
            {
              "name": "groupId",
              "description": "The unique identifier of the chat group."
            },
            {
              "name": "messageId",
              "description": "The unique identifier of the group chat message."
            }
          ]
        }
      },
      {
        "path": "/status_updates/{statusUpdateId}",
        "definition": {
          "entityName": "StatusUpdate",
          "schema": {
            "$ref": "#/backend/entities/StatusUpdate"
          },
          "description": "Stores status updates. Includes 'userId' to identify the owner of the status.",
          "params": [
            {
              "name": "statusUpdateId",
              "description": "The unique identifier of the status update."
            }
          ]
        }
      },
      {
        "path": "/affiliate_products/{productId}",
        "definition": {
          "entityName": "AffiliateProduct",
          "schema": {
            "$ref": "#/backend/entities/AffiliateProduct"
          },
          "description": "Stores affiliate products. Access restricted to admins.",
          "params": [
            {
              "name": "productId",
              "description": "The unique identifier of the affiliate product."
            }
          ]
        }
      },
      {
        "path": "/roles_admin/{userId}",
        "definition": {
          "entityName": "AdminRole",
          "schema": {
            "$ref": "#/backend/entities/UserProfile"
          },
          "description": "Indicates admin privileges. Existence of document grants admin role.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier of the user with admin privileges."
            }
          ]
        }
      }
    ],
    "reasoning": "The Firestore structure is designed to support ConnectSphere's features while adhering to the principles of Authorization Independence, Structural Segregation, Access Modeling, and Data Clarity.  \n\n1.  **User Profiles:** User profiles are stored under `/users/{userId}`. This path-based ownership is secure and efficient.\n2.  **One-to-One Chats:** Chat messages between users are stored in a subcollection `/users/{userId}/chats/{chatId}/messages/{messageId}`. While this initially seems hierarchical, the security rules will depend on the `userId` and sender/recipient data within the `ChatMessage` itself, ensuring Authorization Independence. The `chatId` is generated client-side.\n3.  **Group Chats:** Group chat information is stored under `/groups/{groupId}`. Group membership is managed via a `members` map within each `ChatGroup` document, where keys are user IDs and values are roles (e.g., 'member', 'admin'). This `members` map is denormalized into each `GroupChatMessage` document to ensure Authorization Independence (no `get()` calls). Group chat messages are then stored in `/groups/{groupId}/messages/{messageId}`.\n4.  **Status Updates:** Status updates are stored under `/status_updates/{statusUpdateId}`.  Each status update contains the `userId` of the user who posted it.  A query can efficiently retrieve status updates for a specific user, and security rules can easily enforce that only the user can delete their own status updates.  Because status updates are ephemeral, storing them at the top level simplifies cleanup via a Cloud Function.\n5.  **Affiliate Products:** Affiliate products are stored under `/affiliate_products/{productId}`. Access is restricted to admins. The `adminId` field within each `AffiliateProduct` document indicates which admin added the product.\n6.  **Admin Roles:** Admin status is managed through the `/roles_admin/{userId}` collection. The existence of a document at this path indicates admin privileges.\n\n**Authorization Independence:** Achieved by denormalizing authorization data (e.g., `members` map in group chats, `userId` in status updates) into child documents, eliminating the need for `get()` calls in security rules.\n\n**QAPs Support:**\n\n*   **List operations for users:**  Using `/users/{userId}`, we can list all users (with pagination) and filter. Security rules can restrict which fields are visible based on the requesting user's role or relationship to the target user.\n*   **List operations for group chat messages:** By denormalizing the `members` map into the `GroupChatMessage`, rules can validate if a user is a member of a group when listing messages.\n*   **Admin-only access to Affiliate Products:** The `/affiliate_products` collection is secured such that only users with admin roles (verified by `/roles_admin/{userId}`) can create, update, or delete products. List operations are public.\n"
  }
}
    
    